<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">

    

    

    <title>CRCMS</title>
    <meta name="author" content="simon">
    <meta name="keywords" content>
    <meta name="description" content="大道至简">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">

    
    <link rel="alternate" href="/atom.xml" title="CRCMS" type="application/atom+xml">
    
    
    <link rel="icon" href="/images/favicon.png">
    

    <style type="text/css">
    @font-face {
        font-family: 'icomoon';
        src: url("/fonts/icomoon.eot?q628ml");
        src: url("/fonts/icomoon.eot?q628ml#iefix") format('embedded-opentype'),
             url("/fonts/icomoon.ttf?q628ml") format('truetype'),
             url("/fonts/icomoon.woff?q628ml") format('woff'),
             url("/fonts/icomoon.svg?q628ml#icomoon") format('svg');
        font-weight: normal;
        font-style: normal;
    }
    </style>
    <link rel="stylesheet" href="/css/style.css">

    <!--[if lt IE 9]>
    <style type="text/css">
    .nav-inner {top:0;}
    .author-meta {position:static;top:0;}
    .search-form {height:36px;}
    </style>
    <script type="text/javascript" src="https://unpkg.com/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
    <![endif]-->
</head>
<body>

    <main class="app">
        <header id="header" class="header clearfix">
    <div id="nav" class="nav">
    <div class="nav-mobile">
        <button id="open-panel" class="open-panel nav-mobile-item"><i class="icon-documents"></i></button>
        <h1 class="nav-mobile-title nav-mobile-item">CRCMS</h1>
        <button id="open-menus" class="open-panel nav-mobile-item"><i class="icon-library"></i></button>
    </div>

    <nav id="nav-inner" class="nav-inner">
        
            <a class="nav-item active" href="/">
                <span class="nav-text">首页</span>
            </a>
        
            <a class="nav-item" href="/tags">
                <span class="nav-text">标签</span>
            </a>
        
            <a class="nav-item" href="/archives">
                <span class="nav-text">归档</span>
            </a>
        
            <a class="nav-item" href="/about">
                <span class="nav-text">关于</span>
            </a>
        
            <a class="nav-item" href="/reward">
                <span class="nav-text">支持</span>
            </a>
        
    </nav>
</div>

    <aside id="aside" class="aside">
    <div id="aside-mask" class="aside-mask"></div>
    <div id="aside-inner" class="aside-inner">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"><i class="icon-search-stroke"></i></button><input type="hidden" name="sitesearch" value="http://blog.crcms.cn"></form>

        
        

        
        <div class="author-meta">
            
            <div class="author-avatar">
                <a href="/">
                    <img src="/images/avatar.jpeg" title="Simon">
                </a>
            </div>
            
            <div class="author-name">Simon</div>
            <div class="author-work">Golang,PHP Developer &amp; Designer</div>
            <div class="author-location">
                <i class="icon-location vm"></i>
                <span class="vm">Hefei, China</span>
            </div>
            
            <div class="author-thread-wrap">
                <div class="author-threads clearfix">
                    
                        <a class="thread-item" href="https://github.com/crcms" target="_blank" rel="noopener">
                            <!-- Generated by IcoMoon.io -->
<svg viewbox="0 0 1024 1024" width="38" height="38" fill="currentColor">
<path d="M512 32.12c-265.004 0-479.88 220.23-479.88 492.090 0 217.446 137.536 401.684 328.202 466.81 23.994 4.498 32.778-10.712 32.778-23.78 0-11.782-0.428-42.632-0.642-83.764-133.466 29.778-161.744-65.984-161.744-65.984-21.852-56.772-53.344-71.982-53.344-71.982-43.49-30.636 3.214-29.992 3.214-29.992 48.202 3.428 73.482 50.772 73.482 50.772 42.846 75.196 112.258 53.558 139.68 40.918 4.284-31.706 16.71-53.558 30.42-65.77-106.474-12.426-218.516-54.63-218.516-243.152 0-53.772 18.638-97.69 49.274-131.966-4.928-12.426-21.424-62.556 4.714-130.252 0 0 40.276-13.282 131.966 50.344 38.348-10.926 79.266-16.282 120.184-16.496 40.704 0.214 81.836 5.57 120.184 16.496 91.692-63.626 131.752-50.344 131.752-50.344 26.136 67.698 9.64 117.828 4.714 130.252 30.636 34.492 49.274 78.408 49.274 131.966 0 188.952-112.258 230.514-219.16 242.724 17.138 15.21 32.564 45.202 32.564 91.048 0 65.77-0.642 118.898-0.642 134.966 0 13.068 8.57 28.492 32.992 23.566 191.094-64.912 328.418-249.152 328.418-466.382 0-271.86-214.874-492.090-479.88-492.090z"/>
</svg>

                        </a>
                    
                        <a class="thread-item" href="https://github.com/firmeve" target="_blank" rel="noopener">
                            <!-- Generated by IcoMoon.io -->
<svg viewbox="0 0 1024 1024" width="38" height="38" fill="currentColor">
<path d="M512 32.12c-265.004 0-479.88 220.23-479.88 492.090 0 217.446 137.536 401.684 328.202 466.81 23.994 4.498 32.778-10.712 32.778-23.78 0-11.782-0.428-42.632-0.642-83.764-133.466 29.778-161.744-65.984-161.744-65.984-21.852-56.772-53.344-71.982-53.344-71.982-43.49-30.636 3.214-29.992 3.214-29.992 48.202 3.428 73.482 50.772 73.482 50.772 42.846 75.196 112.258 53.558 139.68 40.918 4.284-31.706 16.71-53.558 30.42-65.77-106.474-12.426-218.516-54.63-218.516-243.152 0-53.772 18.638-97.69 49.274-131.966-4.928-12.426-21.424-62.556 4.714-130.252 0 0 40.276-13.282 131.966 50.344 38.348-10.926 79.266-16.282 120.184-16.496 40.704 0.214 81.836 5.57 120.184 16.496 91.692-63.626 131.752-50.344 131.752-50.344 26.136 67.698 9.64 117.828 4.714 130.252 30.636 34.492 49.274 78.408 49.274 131.966 0 188.952-112.258 230.514-219.16 242.724 17.138 15.21 32.564 45.202 32.564 91.048 0 65.77-0.642 118.898-0.642 134.966 0 13.068 8.57 28.492 32.992 23.566 191.094-64.912 328.418-249.152 328.418-466.382 0-271.86-214.874-492.090-479.88-492.090z"/>
</svg>

                        </a>
                    
                </div>
            </div>
            
        </div>
        
    </div>
</aside>

</header>

        <div id="content" class="content">
            <div id="wrapper" class="wrapper" style="max-width: 800px">
                
    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2019/08/14/linked-list-2-0/">单向链表优化</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://blog.crcms.cn/page/2/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2019-08-14T19:31:21.000Z" itemprop="datePublished">2019-08-15</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/golang/">golang</a>, <a class="article-tag-link" href="/tags/数据结构算法/">数据结构算法</a>, <a class="article-tag-link" href="/tags/链表/">链表</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>在 <a href="./unidirectional-linked-list.md">Golang 单向链表</a> 中是通过不断修改<code>next</code>来实现链表<br>本章通过一个虚拟<code>head</code>方法来优化链表，其原理就是，创建时直接创建<code>head</code>和<code>next</code>,<code>head</code>第一个值始终是<code>nil</code><br>通过<code>head</code>的<code>next</code>来作为初始值，并且对原有链表进行相关优化</p>
<h2 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> node <span class="keyword">struct</span> &#123;</span><br><span class="line">	value <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">	next  *node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> LinkedList <span class="keyword">struct</span> &#123;</span><br><span class="line">	dummyHead *node</span><br><span class="line">	length    <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newNode</span><span class="params">(value <span class="keyword">interface</span>&#123;&#125;, next *node)</span> *<span class="title">node</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;node&#123;</span><br><span class="line">		value: value,</span><br><span class="line">		next:  next,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewLinkedList</span><span class="params">()</span> *<span class="title">LinkedList</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;LinkedList&#123;</span><br><span class="line">		<span class="comment">// 一个虚拟的head value,只使用next</span></span><br><span class="line">		dummyHead: newNode(<span class="literal">nil</span>, newNode(<span class="literal">nil</span>, <span class="literal">nil</span>)),</span><br><span class="line">		length:    <span class="number">0</span>,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加元素</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *LinkedList)</span> <span class="title">Add</span><span class="params">(index <span class="keyword">int</span>, value <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	l.checkIndexRange(index)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//移动指针到指定下标</span></span><br><span class="line">	prev := l.dummyHead</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; index; i++ &#123;</span><br><span class="line">		<span class="comment">// 不断的移动链表指针</span></span><br><span class="line">		<span class="comment">// dummyHead 有个虚拟value，其实是从dummyHead的next作为第一个值</span></span><br><span class="line">		prev = prev.next</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 每当数据更改时，自动修改其head，移动head头指针（往前增加），而不是直接修改next(不是往后增加)</span></span><br><span class="line">	prev.next = newNode(value, prev.next)</span><br><span class="line">	l.length ++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除元素</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *LinkedList)</span> <span class="title">Delete</span><span class="params">(index <span class="keyword">int</span>)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">	l.checkIndexRange(index)</span><br><span class="line"></span><br><span class="line">	prev := l.dummyHead</span><br><span class="line">	<span class="keyword">var</span> current *node</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt;= index; i++ &#123;</span><br><span class="line">		<span class="comment">// 保存当前值</span></span><br><span class="line">		<span class="comment">// dummyHead 有个虚拟value，其实是从dummyHead的next作为第一个值</span></span><br><span class="line">		current = prev.next</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 需要删除的值</span></span><br><span class="line">		<span class="keyword">if</span> i == index &#123;</span><br><span class="line">			<span class="keyword">if</span> current.next != <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="comment">// 移除指定索引，移动指针</span></span><br><span class="line">				<span class="comment">// 当前值的next就等于当前的next，这样就移除了current</span></span><br><span class="line">				prev.next = current.next</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				prev.next = <span class="literal">nil</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			prev = current</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	l.length --</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> current.value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过指定索引获取值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *LinkedList)</span> <span class="title">Index</span><span class="params">(index <span class="keyword">int</span>)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">	l.checkIndexRange(index)</span><br><span class="line"></span><br><span class="line">	prev := l.dummyHead</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt;= index; i++ &#123;</span><br><span class="line">		prev = prev.next</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> prev.value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在链表开头插入值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *LinkedList)</span> <span class="title">Unshift</span><span class="params">(value <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	l.Add(<span class="number">0</span>, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在链表结尾插入值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *LinkedList)</span> <span class="title">Push</span><span class="params">(value <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	l.Add(l.length, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 弹出链表最后一个值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *LinkedList)</span> <span class="title">Pop</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">	<span class="keyword">return</span> l.Delete(l.length - <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 弹出链表第一个值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *LinkedList)</span> <span class="title">Shift</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">	<span class="keyword">return</span> l.Delete(<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *LinkedList)</span> <span class="title">Length</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> l.length</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *LinkedList)</span> <span class="title">checkIndexRange</span><span class="params">(index <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> index &lt; <span class="number">0</span> || index &gt; l.length &#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">`下标越界`</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestNewLinkedList</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	list := NewLinkedList()</span><br><span class="line">	list.Add(<span class="number">0</span>,<span class="string">"a"</span>)</span><br><span class="line">	list.Push(<span class="string">"b"</span>)</span><br><span class="line">	list.Add(<span class="number">2</span>,<span class="string">"c"</span>)</span><br><span class="line">	list.Add(<span class="number">3</span>,<span class="string">"d"</span>)</span><br><span class="line"></span><br><span class="line">	assert.Equal(t,<span class="string">"a"</span>,list.Index(<span class="number">0</span>).(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="string">"b"</span>,list.Index(<span class="number">1</span>).(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="string">"c"</span>,list.Index(<span class="number">2</span>).(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="string">"d"</span>,list.Index(<span class="number">3</span>).(<span class="keyword">string</span>))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 中间追加</span></span><br><span class="line">	list.Add(<span class="number">2</span>,<span class="string">"e"</span>)</span><br><span class="line"></span><br><span class="line">	assert.Equal(t,<span class="string">"e"</span>,list.Index(<span class="number">2</span>).(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="string">"c"</span>,list.Index(<span class="number">3</span>).(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="string">"d"</span>,list.Index(<span class="number">4</span>).(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="number">5</span>,list.Length())</span><br><span class="line"></span><br><span class="line">	assert.Equal(t,<span class="string">"a"</span>,list.Index(<span class="number">0</span>).(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="string">"b"</span>,list.Index(<span class="number">1</span>).(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="string">"e"</span>,list.Index(<span class="number">2</span>).(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="string">"c"</span>,list.Index(<span class="number">3</span>).(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="string">"d"</span>,list.Index(<span class="number">4</span>).(<span class="keyword">string</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	assert.Equal(t,<span class="string">"e"</span>,list.Delete(<span class="number">2</span>))</span><br><span class="line">	assert.Equal(t,<span class="number">4</span>,list.Length())</span><br><span class="line"></span><br><span class="line">	assert.Equal(t,<span class="string">"a"</span>,list.Index(<span class="number">0</span>).(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="string">"b"</span>,list.Index(<span class="number">1</span>).(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="string">"c"</span>,list.Index(<span class="number">2</span>).(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="string">"d"</span>,list.Index(<span class="number">3</span>).(<span class="keyword">string</span>))</span><br><span class="line"></span><br><span class="line">	assert.Equal(t,<span class="string">"d"</span>,list.Pop())</span><br><span class="line">	assert.Equal(t,<span class="number">3</span>,list.Length())</span><br><span class="line">	assert.Equal(t,<span class="string">"a"</span>,list.Index(<span class="number">0</span>).(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="string">"b"</span>,list.Index(<span class="number">1</span>).(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="string">"c"</span>,list.Index(<span class="number">2</span>).(<span class="keyword">string</span>))</span><br><span class="line"></span><br><span class="line">	assert.Equal(t,<span class="string">"a"</span>,list.Shift())</span><br><span class="line">	assert.Equal(t,<span class="number">2</span>,list.Length())</span><br><span class="line">	assert.Equal(t,<span class="string">"b"</span>,list.Index(<span class="number">0</span>).(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="string">"c"</span>,list.Index(<span class="number">1</span>).(<span class="keyword">string</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2019/08/13/go-stack/">Golang container/list 实现 简单stack</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://blog.crcms.cn/page/2/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2019-08-13T13:54:21.000Z" itemprop="datePublished">2019-08-13</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/golang/">golang</a>, <a class="article-tag-link" href="/tags/stack/">stack</a>, <a class="article-tag-link" href="/tags/数据结构算法/">数据结构算法</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="基础实现方法"><a href="#基础实现方法" class="headerlink" title="基础实现方法"></a>基础实现方法</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"container/list"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Stack <span class="keyword">struct</span> &#123;</span><br><span class="line">	list *list.List</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStack</span><span class="params">()</span> *<span class="title">Stack</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;Stack&#123;</span><br><span class="line">		list: list.New(),</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">Push</span><span class="params">(value <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	s.list.PushBack(value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">Pop</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">	e := s.list.Back()</span><br><span class="line">	<span class="keyword">if</span> e != <span class="literal">nil</span> &#123;</span><br><span class="line">		s.list.Remove(e)</span><br><span class="line">		<span class="keyword">return</span> e.Value</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stack)</span> <span class="title">Length</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> s.list.Len()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestNewStack</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	stack := NewStack()</span><br><span class="line">	stack.Push(<span class="string">"a"</span>)</span><br><span class="line">	stack.Push(<span class="string">"b"</span>)</span><br><span class="line">	stack.Push(<span class="string">"c"</span>)</span><br><span class="line">	stack.Push(<span class="string">"d"</span>)</span><br><span class="line">	assert.Equal(t,<span class="number">4</span>,stack.Length())</span><br><span class="line">	v := stack.Pop()</span><br><span class="line">	assert.Equal(t,<span class="string">"d"</span>,v.(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="number">3</span>,stack.Length())</span><br><span class="line">	v = stack.Pop()</span><br><span class="line">	assert.Equal(t,<span class="string">"c"</span>,v.(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="number">2</span>,stack.Length())</span><br><span class="line">	v = stack.Pop()</span><br><span class="line">	assert.Equal(t,<span class="string">"b"</span>,v.(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="number">1</span>,stack.Length())</span><br><span class="line">	v = stack.Pop()</span><br><span class="line">	assert.Equal(t,<span class="string">"a"</span>,v.(<span class="keyword">string</span>))</span><br><span class="line">	assert.Equal(t,<span class="number">0</span>,stack.Length())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2019/08/13/leetcode-20/">Leetcode刷题之有效的括号#20</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://blog.crcms.cn/page/2/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2019-08-13T06:45:38.000Z" itemprop="datePublished">2019-08-13</time>
</a>

            

        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>给定一个只包括 ‘(‘，’)’，’{‘，’}’，’[‘，’]’ 的字符串，判断字符串是否有效。</p>
<p>有效字符串需满足：</p>
<p>左括号必须用相同类型的右括号闭合。<br>左括号必须以正确的顺序闭合。<br>注意空字符串可被认为是有效字符串。</p>
<h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><p>由’(‘，’)’，’{‘，’}’，’[‘，’]’等一一对应，想到的应该是数据栈。</p>
<p>左侧结构的符号入栈，遇到右侧的出栈对比，这样即可一一对应。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsValid</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	stack := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">for</span> _,v := <span class="keyword">range</span> strings.Split(s,<span class="string">``</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> v == <span class="string">`&#123;`</span> || v == <span class="string">`[`</span> || v == <span class="string">`(`</span> &#123;</span><br><span class="line">			stack = <span class="built_in">append</span>(stack, v)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">var</span> sv <span class="keyword">string</span></span><br><span class="line">			<span class="keyword">if</span> <span class="built_in">len</span>(stack) == <span class="number">0</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">len</span>(stack) == <span class="number">1</span> &#123;</span><br><span class="line">				sv = stack[<span class="number">0</span>]</span><br><span class="line">				stack = stack[<span class="number">0</span>:<span class="number">0</span>]</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				sv = stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">				stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> sv == <span class="string">`&#123;`</span> &amp;&amp; v != <span class="string">`&#125;`</span>&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> sv == <span class="string">`[`</span> &amp;&amp; v != <span class="string">`]`</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> sv == <span class="string">`(`</span> &amp;&amp; v != <span class="string">`)`</span>&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>(stack) == <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestIsValid</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	assert.Equal(t,<span class="literal">false</span>,IsValid(<span class="string">"&#123;&#125;&#123;&#123;&#123;&#123;]&#125;&#125;"</span>))</span><br><span class="line">	assert.Equal(t,<span class="literal">true</span>,IsValid(<span class="string">"&#123;&#125;()[]"</span>))</span><br><span class="line">	assert.Equal(t,<span class="literal">true</span>,IsValid(<span class="string">"[&#123;&#123;&#123;&#125;&#125;&#125;]"</span>))</span><br><span class="line">	assert.Equal(t,<span class="literal">true</span>,IsValid(<span class="string">"&#123;([])&#125;"</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2019/08/11/unidirectional-linked-list/">Golang 单向链表</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://blog.crcms.cn/page/2/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2019-08-11T06:58:17.000Z" itemprop="datePublished">2019-08-11</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/golang/">golang</a>, <a class="article-tag-link" href="/tags/数据结构算法/">数据结构算法</a>, <a class="article-tag-link" href="/tags/链表/">链表</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="基础链表"><a href="#基础链表" class="headerlink" title="基础链表"></a>基础链表</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 一个简单的单向链表</span></span><br><span class="line"><span class="keyword">type</span> Node <span class="keyword">struct</span> &#123;</span><br><span class="line">	value <span class="keyword">string</span></span><br><span class="line">	<span class="comment">// 下一个节点</span></span><br><span class="line">	next *Node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> List <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// 表头</span></span><br><span class="line">	header *Node</span><br><span class="line">	<span class="comment">// 总长度</span></span><br><span class="line">	length <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewList</span><span class="params">()</span> *<span class="title">List</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;List&#123;</span><br><span class="line">		header: <span class="literal">nil</span>,</span><br><span class="line">		length: <span class="number">0</span>,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newNode</span><span class="params">(value <span class="keyword">string</span>, next *Node)</span> *<span class="title">Node</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;Node&#123;</span><br><span class="line">		value: value,</span><br><span class="line">		next:  next,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加一个数据至链表</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Add</span><span class="params">(value <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> l.length == <span class="number">0</span> &#123;</span><br><span class="line">		l.header = newNode(value, <span class="literal">nil</span>)</span><br><span class="line">		l.length = <span class="number">1</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		current := l.header</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> current.next == <span class="literal">nil</span> &#123;</span><br><span class="line">				current.next = newNode(value, <span class="literal">nil</span>)</span><br><span class="line">				l.length += <span class="number">1</span></span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			&#125;</span><br><span class="line">			current = current.next</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除链接数据</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Delete</span><span class="params">(value <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	currentNode := l.header</span><br><span class="line">	prevNode := l.header</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> currentNode == <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> currentNode.value == value &#123;</span><br><span class="line">			<span class="comment">// 如果是头节点</span></span><br><span class="line">			<span class="keyword">if</span> currentNode == prevNode &#123;</span><br><span class="line">				l.header = currentNode.next</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="comment">// 否则，上一个节点的next指针等于当前删除的元素的next指针</span></span><br><span class="line">				prevNode.next = currentNode.next</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			l.length -= <span class="number">1</span></span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> currentNode.next == <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		prevNode = currentNode</span><br><span class="line">		currentNode = currentNode.next</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前链表是否包指定值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Contains</span><span class="params">(value <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	currentNode := l.header</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> currentNode == <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> currentNode.value == value &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		currentNode = currentNode.next</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前链表长度</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Length</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> l.length</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestList</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	list := NewList()</span><br><span class="line">	list.Add(<span class="string">"a"</span>)</span><br><span class="line">	list.Add(<span class="string">"b"</span>)</span><br><span class="line">	list.Add(<span class="string">"c"</span>)</span><br><span class="line">	list.Add(<span class="string">"d"</span>)</span><br><span class="line">	assert.Equal(t, <span class="number">4</span>, list.Length())</span><br><span class="line">	assert.Equal(t, <span class="literal">true</span>, list.Delete(<span class="string">"c"</span>))</span><br><span class="line">	<span class="comment">//fmt.Println(list.header.next.next)</span></span><br><span class="line">	assert.Equal(t, <span class="number">3</span>, list.Length())</span><br><span class="line">	assert.Equal(t,<span class="literal">false</span>,list.Contains(<span class="string">"c"</span>))</span><br><span class="line">	assert.Equal(t,<span class="literal">true</span>,list.Contains(<span class="string">"d"</span>))</span><br><span class="line">	assert.Equal(t,<span class="literal">true</span>,list.Contains(<span class="string">"a"</span>))</span><br><span class="line"></span><br><span class="line">	assert.Equal(t,<span class="literal">true</span>,list.Delete(<span class="string">"a"</span>))</span><br><span class="line">	assert.Equal(t, <span class="number">2</span>, list.Length())</span><br><span class="line">	assert.Equal(t,<span class="literal">false</span>,list.Contains(<span class="string">"a"</span>))</span><br><span class="line"></span><br><span class="line">	assert.Equal(t,<span class="literal">true</span>,list.Delete(<span class="string">"d"</span>))</span><br><span class="line">	assert.Equal(t, <span class="number">1</span>, list.Length())</span><br><span class="line">	assert.Equal(t,<span class="literal">false</span>,list.Contains(<span class="string">"d"</span>))</span><br><span class="line"></span><br><span class="line">	assert.Equal(t,<span class="number">1</span>,list.Length())</span><br><span class="line">	assert.Equal(t,<span class="string">"b"</span>,list.header.value)</span><br><span class="line">	assert.Nil(t,list.header.next)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2019/08/09/binary-search/">Golang 二分法查找</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://blog.crcms.cn/page/2/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2019-08-09T06:58:17.000Z" itemprop="datePublished">2019-08-09</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/golang/">golang</a>, <a class="article-tag-link" href="/tags/二分法查找/">二分法查找</a>, <a class="article-tag-link" href="/tags/数据结构算法/">数据结构算法</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="递归二分法查找"><a href="#递归二分法查找" class="headerlink" title="递归二分法查找"></a>递归二分法查找</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BinarySearch</span><span class="params">(array []<span class="keyword">int</span>, target <span class="keyword">int</span>, params ...<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	length := <span class="built_in">len</span>(array)</span><br><span class="line">	maxPoint := length<span class="number">-1</span></span><br><span class="line">	<span class="keyword">var</span> point <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(params) == <span class="number">0</span> &#123;</span><br><span class="line">		point = <span class="keyword">int</span>(maxPoint / <span class="number">2</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		point = params[<span class="number">0</span>]</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (point ==  <span class="number">0</span> || point == maxPoint) &amp;&amp; target != array[point]&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> target == array[point] &#123;</span><br><span class="line">		<span class="keyword">return</span> point</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> target &gt; array[point] &#123;</span><br><span class="line">		max := point + <span class="keyword">int</span>(math.Floor(<span class="keyword">float64</span>(point)/<span class="number">2</span>))</span><br><span class="line">		<span class="keyword">if</span> max &gt; maxPoint &#123;</span><br><span class="line">			max = maxPoint</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> BinarySearch(array, target, max)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123; <span class="comment">//target &lt; array[point]</span></span><br><span class="line">		min := point - <span class="keyword">int</span>(math.Ceil(<span class="keyword">float64</span>(point)/<span class="number">2</span>))</span><br><span class="line">		<span class="keyword">if</span> min &lt; <span class="number">0</span> &#123;</span><br><span class="line">			min = <span class="number">0</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> BinarySearch(array, target, min)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// testing</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestBinarySearch</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	array := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>&#125;</span><br><span class="line">	assert.Equal(t,<span class="number">11</span>,BinarySearch(array, <span class="number">12</span>))</span><br><span class="line">	assert.Equal(t,<span class="number">-1</span>,BinarySearch(array, <span class="number">15</span>))</span><br><span class="line">	assert.Equal(t,<span class="number">0</span>,BinarySearch(array, <span class="number">1</span>))</span><br><span class="line">	assert.Equal(t,<span class="number">-1</span>,BinarySearch(array, <span class="number">-5</span>))</span><br><span class="line">	assert.Equal(t,<span class="number">-1</span>,BinarySearch(array, <span class="number">15</span>))</span><br><span class="line">	assert.Equal(t,<span class="number">10</span>,BinarySearch(array, <span class="number">11</span>))</span><br><span class="line">	assert.Equal(t,<span class="number">4</span>,BinarySearch(array, <span class="number">5</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>二分法的提前是有序的排序</p>
</blockquote>

        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2019/06/25/git-subtree/">通过git subtree来创建自己的子仓库</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://blog.crcms.cn/page/2/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2019-06-25T00:16:31.000Z" itemprop="datePublished">2019-06-25</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/composer/">composer</a>, <a class="article-tag-link" href="/tags/git/">git</a>, <a class="article-tag-link" href="/tags/laravel/">laravel</a>, <a class="article-tag-link" href="/tags/subtree/">subtree</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><p>查看<a href="https://github.com/laravel/framework" target="_blank" rel="noopener"><code>laravel/framework</code></a>，就会发现其实<code>laravel</code>主包是由多个子包构建。<br>每个子包又都可以独立使用，主包中相关子包的<code>commit</code>必须一致，同时还需要同步更新方便。如何做到这一点的呢？</p>
<h2 id="Subtree"><a href="#Subtree" class="headerlink" title="Subtree"></a>Subtree</h2><h3 id="subtree-是什么"><a href="#subtree-是什么" class="headerlink" title="subtree 是什么"></a>subtree 是什么</h3><p><code>git subtree</code> 可以实现一个仓库作为其他仓库的子仓库。或者说，可以实现一个主仓库包含多个子仓库。</p>
<h3 id="subtree-的使用"><a href="#subtree-的使用" class="headerlink" title="subtree 的使用"></a>subtree 的使用</h3><p>查看<code>git subtree --help</code>，发现命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git subtree add   -P &lt;prefix&gt; &lt;commit&gt;</span><br><span class="line">git subtree add   -P &lt;prefix&gt; &lt;repository&gt; &lt;ref&gt;</span><br><span class="line">git subtree pull  -P &lt;prefix&gt; &lt;repository&gt; &lt;ref&gt;</span><br><span class="line">git subtree push  -P &lt;prefix&gt; &lt;repository&gt; &lt;ref&gt;</span><br><span class="line">git subtree merge -P &lt;prefix&gt; &lt;commit&gt;</span><br><span class="line">git subtree split -P &lt;prefix&gt; [OPTIONS] [&lt;commit&gt;]</span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>使用以下简写来代表仓库名称：</p>
<ul>
<li><code>A</code>：主仓库</li>
<li><code>B</code>：子仓库</li>
</ul>
<ol>
<li>首先新建一个A仓库，进入A的主目录，在A仓库中执行命令（假定所有子仓库目录都存在于<code>A/src</code>中）<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git subtree add -P src/B https://github.com/B.git master</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>此时subtree则在<code>A</code>仓库中绑定了<code>B</code>仓库</p>
<ol start="2">
<li><p>进入<code>A/src/B</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch <span class="built_in">test</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>A</code>根目录提交<code>commit</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add src/B/<span class="built_in">test</span></span><br><span class="line">git commit -m <span class="string">"subtree test"</span></span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>那是如何同步相关<code>commit</code>到子仓库呢？<code>subtree push</code>即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git subtree push -P src/B https://github.com/B.git master</span><br></pre></td></tr></table></figure>

<p>即此，已经完成<code>A</code>,<code>B</code>仓库相关<code>commit</code>同步</p>
<h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><p>如果，<code>A/src</code>中有很多子仓库，每次更新完成后，手动更新N个子仓库非常让人头疼，索性搞个Bash跑一遍</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="built_in">set</span> -euo pipefail</span><br><span class="line"></span><br><span class="line">TARGET_DIRECTORY=<span class="string">"<span class="variable">$(pwd)</span>/src"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> git.branch &#123;</span><br><span class="line">  br=`git branch | grep <span class="string">"*"</span>`</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$&#123;br/* /&#125;</span></span><br><span class="line">&#125;</span><br><span class="line">BRANCH=$(git.branch)</span><br><span class="line"></span><br><span class="line"><span class="comment"># each所有目录</span></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> `ls <span class="variable">$&#123;TARGET_DIRECTORY&#125;</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [[ -d <span class="string">"<span class="variable">$&#123;TARGET_DIRECTORY&#125;</span>/<span class="variable">$&#123;file&#125;</span>"</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">"==================Current:<span class="variable">$&#123;file&#125;</span>==================\n"</span></span><br><span class="line">        <span class="built_in">echo</span> `git subtree push -P src/<span class="variable">$&#123;file&#125;</span> git@github.com:<span class="variable">$&#123;file&#125;</span>.git <span class="variable">$&#123;BRANCH&#125;</span>`</span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">"\n"</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="Composer-replace"><a href="#Composer-replace" class="headerlink" title="Composer replace"></a>Composer replace</h2><p>可以看到在<code>laravel/composer.json</code>中有<code>replace</code>属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;replace&quot;: &#123;</span><br><span class="line">    &quot;illuminate/auth&quot;: &quot;self.version&quot;,</span><br><span class="line">    &quot;illuminate/broadcasting&quot;: &quot;self.version&quot;,</span><br><span class="line">    &quot;illuminate/bus&quot;: &quot;self.version&quot;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么如果是<code>PHP</code>情况下我们也可以，使用<code>replace</code>来在主包中加载子包依赖，从而提升统一版本更新的便捷性。</p>
<h2 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h2><p><a href="https://docs.phpcomposer.com/04-schema.html#replace" target="_blank" rel="noopener">Composer Replace使用</a><br><a href="https://git-scm.com/docs/git-pull#Documentation/git-pull.txt-subtreeltpathgt" target="_blank" rel="noopener">Git subtree使用</a></p>

        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2019/06/14/laravel-env/">Laravel env 下特殊字符的坑</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://blog.crcms.cn/page/2/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2019-06-14T18:09:50.000Z" itemprop="datePublished">2019-06-15</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/env/">env</a>, <a class="article-tag-link" href="/tags/laravel/">laravel</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><p>今天在部署服务器时，线上数据库使用了特殊字符，结果导致<code>mysql</code>连接一直是出错的状态。<br>通过<code>my-cli</code>连接却是OK，于是想到是否是帐号密码错误，打印下<code>env</code>或<code>config</code>，发现因为出现了<code>#</code>字符，后面被自动截断。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>第一反应是对于特殊字符如<code># \</code>，应该加上<code>&quot;&quot;</code>，测试下确实得到解决。</p>
<h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><p>首先想到肯定是在加载env，定位<code>Bootstrap/LoadEnvironmentVariables</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;createDotenv($app)-&gt;safeLoad();</span><br><span class="line">&#125; <span class="keyword">catch</span> (InvalidFileException $e) &#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;writeErrorAndDie($e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>继续往下，定位<code>safeLoad</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">safeLoad</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;loadData();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvalidPathException $e) &#123;</span><br><span class="line">        <span class="comment">// suppressing exception</span></span><br><span class="line">        <span class="keyword">return</span> [];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再通过<code>loadData</code>往下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">load</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;loadDirect(</span><br><span class="line">        <span class="keyword">self</span>::findAndRead(<span class="keyword">$this</span>-&gt;filePaths)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终通过<code>processEntries</code>定位，找到处理<code>value</code>的核心方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">parseValue</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($value === <span class="keyword">null</span> || trim($value) === <span class="string">''</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> $value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> array_reduce(str_split($value), <span class="function"><span class="keyword">function</span> <span class="params">($data, $char)</span> <span class="title">use</span> <span class="params">($value)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">switch</span> ($data[<span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="keyword">self</span>::INITIAL_STATE:</span><br><span class="line">                    <span class="keyword">if</span> ($char === <span class="string">'"'</span> || $char === <span class="string">'\''</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> [$data[<span class="number">0</span>], <span class="keyword">self</span>::QUOTED_STATE];</span><br><span class="line">                    &#125; <span class="keyword">elseif</span> ($char === <span class="string">'#'</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> [$data[<span class="number">0</span>], <span class="keyword">self</span>::COMMENT_STATE];</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> [$data[<span class="number">0</span>].$char, <span class="keyword">self</span>::UNQUOTED_STATE];</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="keyword">self</span>::UNQUOTED_STATE:</span><br><span class="line">                    <span class="keyword">if</span> ($char === <span class="string">'#'</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> [$data[<span class="number">0</span>], <span class="keyword">self</span>::COMMENT_STATE];</span><br><span class="line">                    &#125; <span class="keyword">elseif</span> (ctype_space($char)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> [$data[<span class="number">0</span>], <span class="keyword">self</span>::WHITESPACE_STATE];</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> [$data[<span class="number">0</span>].$char, <span class="keyword">self</span>::UNQUOTED_STATE];</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="keyword">self</span>::QUOTED_STATE:</span><br><span class="line">                    <span class="keyword">if</span> ($char === $value[<span class="number">0</span>]) &#123;</span><br><span class="line">                        <span class="keyword">return</span> [$data[<span class="number">0</span>], <span class="keyword">self</span>::WHITESPACE_STATE];</span><br><span class="line">                    &#125; <span class="keyword">elseif</span> ($char === <span class="string">'\\'</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> [$data[<span class="number">0</span>], <span class="keyword">self</span>::ESCAPE_STATE];</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> [$data[<span class="number">0</span>].$char, <span class="keyword">self</span>::QUOTED_STATE];</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="keyword">self</span>::ESCAPE_STATE:</span><br><span class="line">                    <span class="keyword">if</span> ($char === $value[<span class="number">0</span>] || $char === <span class="string">'\\'</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> [$data[<span class="number">0</span>].$char, <span class="keyword">self</span>::QUOTED_STATE];</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> InvalidFileException(</span><br><span class="line">                            <span class="keyword">self</span>::getErrorMessage(<span class="string">'an unexpected escape sequence'</span>, $value)</span><br><span class="line">                        );</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="keyword">self</span>::WHITESPACE_STATE:</span><br><span class="line">                    <span class="keyword">if</span> ($char === <span class="string">'#'</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> [$data[<span class="number">0</span>], <span class="keyword">self</span>::COMMENT_STATE];</span><br><span class="line">                    &#125; <span class="keyword">elseif</span> (!ctype_space($char)) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> InvalidFileException(</span><br><span class="line">                            <span class="keyword">self</span>::getErrorMessage(<span class="string">'unexpected whitespace'</span>, $value)</span><br><span class="line">                        );</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> [$data[<span class="number">0</span>], <span class="keyword">self</span>::WHITESPACE_STATE];</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="keyword">self</span>::COMMENT_STATE:</span><br><span class="line">                    <span class="keyword">return</span> [$data[<span class="number">0</span>], <span class="keyword">self</span>::COMMENT_STATE];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, [<span class="string">''</span>, <span class="keyword">self</span>::INITIAL_STATE])[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>可以看到对于<code>#</code>和<code>\</code>的处理。</p>
<p>关于<code>array_reduce</code>函数，请<a href="https://www.php.net/manual/zh/function.array-reduce.php" target="_blank" rel="noopener">参考文档</a></p>

        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2019/05/05/golang-interface-basic/">Golang Interface 基础示例一</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://blog.crcms.cn/page/2/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2019-05-05T15:49:04.000Z" itemprop="datePublished">2019-05-05</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/Golang/">Golang</a>, <a class="article-tag-link" href="/tags/Interface/">Interface</a>, <a class="article-tag-link" href="/tags/接口/">接口</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <p>路径<code>interfaces/demo.go</code></p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> interfaces</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Summationer <span class="keyword">interface</span> &#123;</span><br><span class="line">	Sum(param1, param2 <span class="keyword">int</span>) <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Summation <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Summation)</span> <span class="title">Sum</span><span class="params">(param1, param2 <span class="keyword">int</span>)</span> <span class="title">int</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> param1 + param2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>main</code>调用</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"interfaces"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// Go的接口是动态的</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 申明一个结构体</span></span><br><span class="line">	sum_struct := <span class="built_in">new</span>(interfaces.Summation)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 给当前结构体对象增加一个接口</span></span><br><span class="line">	<span class="comment">//var sumInter interfaces.Summationer</span></span><br><span class="line">	<span class="comment">//sumInter = sum_struct</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 或者使用如下方法</span></span><br><span class="line">	<span class="comment">// sumInter := interfaces.Summationer(sum_struct)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 或者，这样其实接口也是通的，但并没有什么太大意义</span></span><br><span class="line">	<span class="comment">// 语法上看不出来结构体实现了此接口</span></span><br><span class="line">	sumInter := sum_struct</span><br><span class="line"></span><br><span class="line">	fmt.Println(testInterface(sumInter))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testInterface</span><span class="params">(s interfaces.Summationer)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> s.Sum(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2019/04/25/jenkins-gitlab-bash/">Gitlab+Jenkins+Bash 搭建多流水线自动部署</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://blog.crcms.cn/page/2/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2019-04-25T23:21:14.000Z" itemprop="datePublished">2019-04-26</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/gitlab/">gitlab</a>, <a class="article-tag-link" href="/tags/jenkins/">jenkins</a>, <a class="article-tag-link" href="/tags/pipeline/">pipeline</a>, <a class="article-tag-link" href="/tags/自动部署/">自动部署</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <p><img src="/images/jenkins-gitlab-bash/1.png" alt="jenkins pipeline" title="jenkins pipeline"></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>因为涉及到的子项目非常多，为了方便统一更新部署测试等相关运行代码，所以<code>Jenkinsfile</code>在本项目中只是起到一个阶段挂载的作用，大部分部署代码使用的是<code>Bash</code>。<br>此方法并不适合大规模集群部署。</p>
<h2 id="Jenkins安装"><a href="#Jenkins安装" class="headerlink" title="Jenkins安装"></a>Jenkins安装</h2><h3 id="安装启动"><a href="#安装启动" class="headerlink" title="安装启动"></a>安装启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d jenkins</span><br></pre></td></tr></table></figure>

<blockquote>
<p>本环境中使用的是laradock中Jenkins进行安装，如果非<code>Docker</code>请参考官方文档进行安装</p>
</blockquote>
<h3 id="增加Jenkins插件"><a href="#增加Jenkins插件" class="headerlink" title="增加Jenkins插件"></a>增加Jenkins插件</h3><p>在<code>系统管理</code>-&gt;<code>插件管理</code>中安装<code>Blue Ocean</code>和<code>GitLab</code>插件</p>
<h3 id="在项目根目录新建Jenkinsfile"><a href="#在项目根目录新建Jenkinsfile" class="headerlink" title="在项目根目录新建Jenkinsfile"></a>在项目根目录新建Jenkinsfile</h3><p>关于Jenkinsfile相关文档，请参考<a href="https://jenkins.io/zh/doc/book/pipeline/" target="_blank" rel="noopener">官网</a></p>
<h3 id="增加单独Build的bash项目，于用执行具体步骤流程"><a href="#增加单独Build的bash项目，于用执行具体步骤流程" class="headerlink" title="增加单独Build的bash项目，于用执行具体步骤流程"></a>增加单独Build的bash项目，于用执行具体步骤流程</h3><p>因公司内部使用，So ……</p>
<h3 id="创建流水线"><a href="#创建流水线" class="headerlink" title="创建流水线"></a>创建流水线</h3><p>打开 <code>Open Blue Ocean</code> 选择一个创建流水线项目，当然需要加上gitlab的ssk-key，否则无法进行拉取</p>
<h3 id="Gitlab配置webhook"><a href="#Gitlab配置webhook" class="headerlink" title="Gitlab配置webhook"></a>Gitlab配置webhook</h3><ul>
<li><code>Jenkins</code> -&gt; <code>系统配置</code> -&gt; <code>Gitlab</code> 进行配置测试连接Gitlab</li>
<li><code>Jenkins项目</code> -&gt; <code>选择分支</code> -&gt; <code>view configure</code> -&gt; <code>构建触发器</code> 找到gitlab webhook选项</li>
<li><code>gitlab管理</code> -&gt; <code>设置</code> -&gt; <code>集成</code> 增加webhook url</li>
</ul>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><h3 id="关于自动部署"><a href="#关于自动部署" class="headerlink" title="关于自动部署"></a>关于自动部署</h3><p>使用的是<code>scp</code>+<code>ssh</code>+<code>ssh-key</code>+<code>hook.sh</code>来实现的自动远程部署以及部署后需要执行的命令</p>
<ul>
<li>服务器增加远程部署帐号（如果需要<code>sudo</code>，则要开启<code>sudo</code>免密，在<code>sudoers.d</code>中增加<code>account ALL=(ALL:ALL) NOPASSWD: ALL</code>，具体权限以项目需求为准）</li>
<li>使用<code>scp</code>上传</li>
<li><code>ssh</code> 登录，并执行常规操作</li>
<li><code>hook.sh</code> 进行部署的后期操作</li>
</ul>
<blockquote>
<p>此方法实现简单，但安全性并不是特别高。<br>    所以必须要保证ssh-key不可丢失，以及最好限制ssh的登录IP</p>
</blockquote>
<blockquote>
<p>关于部署失败进行回滚操作，暂未实现，不过可以提供一个思路参考：<br>备份部署前的代码，失败则解压上一次的代码进行覆盖回滚，执行<code>hook.sh</code>即可</p>
</blockquote>
<h3 id="关于Bash执行及异常停止"><a href="#关于Bash执行及异常停止" class="headerlink" title="关于Bash执行及异常停止"></a>关于Bash执行及异常停止</h3><p>默认Bash并不会异常停止，以及需要打印变量输出，以及管道错误处理，需要在Bash头上加上如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set -euxo pipefail</span><br></pre></td></tr></table></figure>

<blockquote>
<p>具体请参考：<a href="http://www.ruanyifeng.com/blog/2017/11/bash-set.html?utm_source=tool.lu" target="_blank" rel="noopener">Bash 脚本 set 命令教程</a></p>
</blockquote>
<h3 id="Jenkins-Dockfile-执行时加载路径问题"><a href="#Jenkins-Dockfile-执行时加载路径问题" class="headerlink" title="Jenkins Dockfile 执行时加载路径问题"></a>Jenkins Dockfile 执行时加载路径问题</h3><p>关于使用<code>Dockfile</code>作为<code>agent</code>环境，因为多子项目共用，并未放在单独的项目下，在公用<code>build</code>其调用路径相当于以当前项目作为根目录，层层往上，如下：</p>
<p>建议使用-v挂载一些常用缓存目录，如<code>composer/.cache</code>等</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">agent &#123;</span><br><span class="line">        dockerfile &#123;</span><br><span class="line">            filename &quot;../../build/php/Dockerfile&quot;</span><br><span class="line">            dir &quot;../../build/php&quot;</span><br><span class="line">            additionalBuildArgs &apos;&apos;</span><br><span class="line">            args &apos;-v /tmp/composer:/root/.composer&apos;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Gitlab-webhook-访问本地网络"><a href="#Gitlab-webhook-访问本地网络" class="headerlink" title="Gitlab webhook 访问本地网络"></a>Gitlab webhook 访问本地网络</h3><p><code>管理区域</code> -&gt; <code>设置</code> -&gt; <code>Outbound requests</code> -&gt; <code>允许钩子和服务访问本地网络</code></p>
<h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><h3 id="本地Jenkinsfile一个简单模板"><a href="#本地Jenkinsfile一个简单模板" class="headerlink" title="本地Jenkinsfile一个简单模板"></a>本地Jenkinsfile一个简单模板</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">        dockerfile &#123;</span><br><span class="line">            filename &quot;../../build/php/Dockerfile&quot;</span><br><span class="line">            dir &quot;../../build/php&quot;</span><br><span class="line">            additionalBuildArgs &apos;&apos;</span><br><span class="line">            args &apos;-v /tmp/composer:/root/.composer&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    environment &#123;</span><br><span class="line">        EX_JENKINS_HOME = &quot;$&#123;JENKINS_HOME&#125;&quot;</span><br><span class="line">        EX_CURRENT_APP = &quot;project-name&quot;</span><br><span class="line">        EX_CURRENT_ENV = &quot;$&#123;BRANCH_NAME&#125;&quot;</span><br><span class="line">        DO_RELEASE = &apos;yes&apos;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(&apos;Prepare&apos;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo &apos;Prepare&apos;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(&apos;Build&apos;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh &quot;$&#123;JENKINS_HOME&#125;/build/scripts/build.sh php&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(&apos;Test&apos;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh &quot;$&#123;JENKINS_HOME&#125;/build/scripts/test.sh php&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(&apos;Release?&apos;) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                branch &apos;product&apos;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                script &#123;</span><br><span class="line">                    env.DO_RELEASE = input &quot;Should we continue?&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(&apos;Deploy&apos;) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                environment name: &apos;DO_RELEASE&apos;, value: &apos;yes&apos;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh &quot;$&#123;JENKINS_HOME&#125;/build/scripts/deploy.sh php&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="PHP-Dockerfile-agent"><a href="#PHP-Dockerfile-agent" class="headerlink" title="PHP Dockerfile agent"></a>PHP Dockerfile agent</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu:latest</span><br><span class="line"></span><br><span class="line">MAINTAINER simon</span><br><span class="line"></span><br><span class="line">USER root</span><br><span class="line"></span><br><span class="line">ARG ARG_TIMEZONE=Asia/Shanghai</span><br><span class="line">RUN ln -snf /usr/share/zoneinfo/$&#123;ARG_TIMEZONE&#125; /etc/localtime &amp;&amp; echo $&#123;ARG_TIMEZONE&#125; &gt; /etc/timezone</span><br><span class="line"></span><br><span class="line">RUN apt-get update -yqq \</span><br><span class="line">    &amp;&amp; apt-get install -y sudo \</span><br><span class="line">    &amp;&amp; apt-get install -y php7.2-dev \</span><br><span class="line">    &amp;&amp; apt-get install -y php7.2-mbstring \</span><br><span class="line">    &amp;&amp; apt-get install -y php7.2-curl \</span><br><span class="line">    &amp;&amp; apt-get install -y php7.2-mysql \</span><br><span class="line">    &amp;&amp; apt-get install -y php7.2-zip \</span><br><span class="line">    &amp;&amp; apt-get install -y php7.2-gd \</span><br><span class="line">    &amp;&amp; apt-get install -y php7.2-bcmath \</span><br><span class="line">    &amp;&amp; apt-get install -y composer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### php pecl #############################</span><br><span class="line">RUN pecl channel-update pecl.php.net</span><br><span class="line"></span><br><span class="line">ARG ARG_PHP_MODS_AVAILABLE_PATH=/etc/php/7.2/mods-available</span><br><span class="line">ARG ARG_PHP_CONF_PATH=/etc/php/7.2/cli/conf.d</span><br><span class="line"></span><br><span class="line"># mongodb</span><br><span class="line">RUN pecl install mongodb \</span><br><span class="line">    &amp;&amp; echo &quot;extension=mongodb.so&quot; &gt; $&#123;ARG_PHP_MODS_AVAILABLE_PATH&#125;/mongodb.ini \</span><br><span class="line">    &amp;&amp; ln -s $&#123;ARG_PHP_MODS_AVAILABLE_PATH&#125;/mongodb.ini $&#123;ARG_PHP_CONF_PATH&#125;/20-mongodb.ini</span><br><span class="line"></span><br><span class="line"># redis</span><br><span class="line">RUN pecl install igbinary \</span><br><span class="line">    &amp;&amp; echo &quot;extension=igbinary.so&quot; &gt; $&#123;ARG_PHP_MODS_AVAILABLE_PATH&#125;/igbinary.ini \</span><br><span class="line">    &amp;&amp; ln -s $&#123;ARG_PHP_MODS_AVAILABLE_PATH&#125;/igbinary.ini $&#123;ARG_PHP_CONF_PATH&#125;/20-igbinary.ini \</span><br><span class="line">    &amp;&amp; pecl install redis \</span><br><span class="line">    &amp;&amp; echo &quot;extension=redis.so&quot; &gt; $&#123;ARG_PHP_MODS_AVAILABLE_PATH&#125;/redis.ini \</span><br><span class="line">    &amp;&amp; ln -s $&#123;ARG_PHP_MODS_AVAILABLE_PATH&#125;/redis.ini $&#123;ARG_PHP_CONF_PATH&#125;/20-redis.ini</span><br><span class="line"></span><br><span class="line"># swoole</span><br><span class="line">RUN pecl install swoole \</span><br><span class="line">    &amp;&amp; echo &quot;extension=swoole.so&quot; &gt; $&#123;ARG_PHP_MODS_AVAILABLE_PATH&#125;/swoole.ini \</span><br><span class="line">    &amp;&amp; ln -s $&#123;ARG_PHP_MODS_AVAILABLE_PATH&#125;/swoole.ini $&#123;ARG_PHP_CONF_PATH&#125;/20-swoole.ini</span><br><span class="line"></span><br><span class="line">#### clear #############################</span><br><span class="line"># clear Ubuntu image will run automatically apt-get clean,so is not need apt-get clean</span><br><span class="line">RUN apt-get -y autoremove</span><br><span class="line"></span><br><span class="line">WORKDIR &quot;/data&quot;</span><br><span class="line"></span><br><span class="line">CMD [&quot;/bin/bash&quot;]</span><br></pre></td></tr></table></figure>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/2019/04/12/ubuntu-install/">ubuntu18.04 安装</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://blog.crcms.cn/page/2/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2019-04-12T19:25:31.000Z" itemprop="datePublished">2019-04-13</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/ubuntu/">ubuntu</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><p>尝试了<code>windows</code>,<code>macos</code>,<code>ubuntu</code>，最后还是觉得<code>ubuntu</code>好用。<br>可能是屌丝本质或者我没有领悟其精髓，<code>macos</code>在我看来并不好用，但界面确实还可以。<br>为了方便我折合了大部分于shell中，可以直接运行shell安装 <a href="https://github.com/crcms/system-initialization" target="_blank" rel="noopener">https://github.com/crcms/system-initialization</a></p>
<p>来几张图看看效果</p>
<p><img src="/images/ubuntu-install/1.png" alt="ubuntu桌面1"><br><img src="/images/ubuntu-install/2.png" alt="ubuntu桌面2"></p>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><h3 id="基础功能包"><a href="#基础功能包" class="headerlink" title="基础功能包"></a>基础功能包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt update</span></span><br><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line">sudo apt-get install -y vim unzip git</span><br></pre></td></tr></table></figure>

<h3 id="最主要的是什么，当然是terminal，推荐deepin-terminal个人感觉非常好用"><a href="#最主要的是什么，当然是terminal，推荐deepin-terminal个人感觉非常好用" class="headerlink" title="最主要的是什么，当然是terminal，推荐deepin terminal个人感觉非常好用"></a>最主要的是什么，当然是<code>terminal</code>，推荐<code>deepin terminal</code>个人感觉非常好用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install zssh</span><br><span class="line">sudo apt-get install deepin-terminal</span><br></pre></td></tr></table></figure>

<h3 id="输入法"><a href="#输入法" class="headerlink" title="输入法"></a>输入法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 搜索拼音</span></span><br><span class="line">wget http://cdn2.ime.sogou.com/dl/index/1524572264/sogoupinyin_2.2.0.0108_amd64.deb -O suogoupingyin.deb</span><br><span class="line">sudo dpkg -i suogoupingyin.deb</span><br><span class="line">sudo apt-get install -f</span><br><span class="line">sudo dpkg -i suogoupingyin.deb</span><br><span class="line"><span class="comment"># 五笔</span></span><br><span class="line">sudo apt-get install fcitx-table-wubi</span><br></pre></td></tr></table></figure>

<h3 id="常用功能包"><a href="#常用功能包" class="headerlink" title="常用功能包"></a>常用功能包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://gitee.com/wszqkzqk/deepin-wine-for-ubuntu.git ~/deepin-wine-for-ubuntu</span><br><span class="line">sudo bash ~/deepin-wine-for-ubuntu/install.sh</span><br><span class="line"><span class="comment"># qq</span></span><br><span class="line">wget http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.qq.im/deepin.com.qq.im_8.9.19983deepin23_i386.deb -O qq.deb</span><br><span class="line">sudo dpkg -i qq.deb</span><br><span class="line"><span class="comment"># 徾信</span></span><br><span class="line">wget http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.wechat/deepin.com.wechat_2.6.2.31deepin0_i386.deb -O weichat.deb</span><br><span class="line">sudo dpkg -i weichat.deb</span><br><span class="line"><span class="comment"># 百度网盘</span></span><br><span class="line">wget http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.baidu.pan/deepin.com.baidu.pan_5.7.3deepin0_i386.deb -O pan.deb</span><br><span class="line">sudo dpkg -i pan.deb</span><br><span class="line"><span class="comment"># 迅雷</span></span><br><span class="line">wget http://mirrors.aliyun.com/deepin/pool/non-free/d/deepin.com.thunderspeed/deepin.com.thunderspeed_7.10.35.366deepin18_i386.deb -O xunlei.deb</span><br><span class="line">sudo dpkg -i xunlei.deb</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里非常感谢开源作者 <a href="https://github.com/wszqkzqk/deepin-wine-ubuntu" target="_blank" rel="noopener">https://github.com/wszqkzqk/deepin-wine-ubuntu</a></p>
</blockquote>
<h3 id="oh-my-zsh"><a href="#oh-my-zsh" class="headerlink" title="oh my zsh"></a>oh my zsh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install -y curl zsh</span><br><span class="line">zsh --version</span><br><span class="line">chsh -s $(<span class="built_in">which</span> zsh)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$SHELL</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">sudo sh -c <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)</span>"</span></span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>

<h4 id="增加代码提示插件"><a href="#增加代码提示插件" class="headerlink" title="增加代码提示插件"></a>增加代码提示插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-autosuggestions</span><br></pre></td></tr></table></figure>

<h4 id="修改皮肤，增加Plugin"><a href="#修改皮肤，增加Plugin" class="headerlink" title="修改皮肤，增加Plugin"></a>修改皮肤，增加Plugin</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.zshrc</span><br><span class="line"><span class="comment"># ZSH_THEME="af-magic" (个人比较喜欢这一款)</span></span><br><span class="line"><span class="comment"># plugins=(git zsh-autosuggestions)</span></span><br></pre></td></tr></table></figure>

<h3 id="Socks代理"><a href="#Socks代理" class="headerlink" title="Socks代理"></a>Socks代理</h3><h4 id="shadowsocks-安装"><a href="#shadowsocks-安装" class="headerlink" title="shadowsocks 安装"></a>shadowsocks 安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">shadowsocks_path=/opt/shadowsocks</span><br><span class="line"><span class="comment"># 直接是本地已经包了</span></span><br><span class="line">sudo cp -r ./tools/shadowsocks /opt</span><br><span class="line">sudo chmod +x <span class="variable">$&#123;shadowsocks_path&#125;</span>/Shadowsocks-Qt5-3.0.1-x86_64.AppImage</span><br><span class="line">sudo cp <span class="variable">$&#123;shadowsocks_path&#125;</span>/shadowsocks.desktop /usr/share/applications</span><br><span class="line">sudo apt-get install -y python-pip</span><br><span class="line">sudo pip install -U genpac</span><br><span class="line">genpac --proxy=<span class="string">"SOCKS5 127.0.0.1:1080"</span> --gfwlist-proxy=<span class="string">"SOCKS5 127.0.0.1:1080"</span> -o autoproxy.pac --gfwlist-url=<span class="string">"https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt"</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>shadowsocks的下载地址 <a href="https://github.com/shadowsocks/shadowsocks-qt5" target="_blank" rel="noopener">https://github.com/shadowsocks/shadowsocks-qt5</a></p>
</blockquote>
<h4 id="命令行开启代理"><a href="#命令行开启代理" class="headerlink" title="命令行开启代理"></a>命令行开启代理</h4><p>在<code>bashrc</code>或<code>zshrc</code>中加入两函数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># proxy</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">proxy_off</span></span>() &#123;</span><br><span class="line">     <span class="built_in">unset</span> all_proxy</span><br><span class="line">     <span class="built_in">echo</span> -e <span class="string">"已关闭代理"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">proxy_on</span></span>() &#123;</span><br><span class="line">     <span class="built_in">export</span> no_proxy=<span class="string">"localhost,127.0.0.1,localaddress,.localdomain.com,.test"</span></span><br><span class="line">     <span class="built_in">export</span> all_proxy=socks5://127.0.0.1:1080</span><br><span class="line">     <span class="built_in">echo</span> -e <span class="string">"已开启代理"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要时在命令行中执行<code>proxy_off</code>或<code>proxy_on</code>即可</p>
</blockquote>
<h3 id="开发工具包"><a href="#开发工具包" class="headerlink" title="开发工具包"></a>开发工具包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gitkraken</span></span><br><span class="line">wget https://release.axocdn.com/linux/gitkraken-amd64.deb -O gitkraken.deb</span><br><span class="line">sudo dpkg -i gitkraken.deb</span><br><span class="line"></span><br><span class="line"><span class="comment"># PhpStorm</span></span><br><span class="line">wget https://download.jetbrains.8686c.com/webide/PhpStorm-2018.3.5.tar.gz -O PhpStorm.tar.gz</span><br><span class="line">sudo tar xfz PhpStorm.tar.gz -C /opt/</span><br><span class="line">sudo chmod +x Php*/bin/phpstorm.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># Goland</span></span><br><span class="line">wget https://download.jetbrains.8686c.com/go/goland-2018.3.5.tar.gz -O goland.tar.gz</span><br><span class="line">sudo tar xfz goland.tar.gz -C /opt/</span><br><span class="line">sudo chmod +x Go*/bin/goland.sh</span><br></pre></td></tr></table></figure>

<h2 id="美化，强制macos"><a href="#美化，强制macos" class="headerlink" title="美化，强制macos"></a>美化，强制<code>macos</code></h2><p><img src="/images/ubuntu-install/3.png" alt="tweak"><br><img src="/images/ubuntu-install/4.png" alt="tweak"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install -y gnome-tweak-tool gnome-shell-extensions gnome-shell-extension-dashtodock gnome-shell-extension-top-icons-plus chrome-gnome-shell</span><br></pre></td></tr></table></figure>

<h3 id="主题安装"><a href="#主题安装" class="headerlink" title="主题安装"></a>主题安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装GTK3主题或 McHigh Sierra </span></span><br><span class="line"><span class="comment"># https://github.com/vinceliuice/Sierra-gtk-theme/raw/releases/Sierra-light.tar.xz</span></span><br><span class="line"><span class="comment"># https://github.com/vinceliuice/Sierra-gtk-theme/raw/releases/Sierra-dark.tar.xz</span></span><br><span class="line">wget https://dl.opendesktop.org/api/files/download/id/1523902544/s/ede5bc5c844b290e6e136ca68ae22cb2b72575769e1e9e6488acbfb3979c31b92fe01e8403fafe485a6c4c6f1b4a2fd1cd81806b455d6ffb613aac886ab9755d/t/1553693498/u//X-Arc-Collection-v1.4.9.zip -O X-Arc-Collection.zip</span><br><span class="line">unzip -d /usr/share/themes X-Arc-Collection.zip </span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载Mac图标主题 la-capitaine-icon-theme</span></span><br><span class="line">wget https://github.com/keeferrourke/la-capitaine-icon-theme/archive/v0.6.1.tar.gz -O la-capitaine-icon.tra.gz</span><br><span class="line">tar zxvf la-capitaine-icon.tra.gz -C /usr/share/icons</span><br></pre></td></tr></table></figure>

<h3 id="应用主题"><a href="#应用主题" class="headerlink" title="应用主题"></a>应用主题</h3><ul>
<li><code>tweak-&gt;外观-&gt;应用主题或Shell</code></li>
<li>重启<code>Gnome</code></li>
</ul>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h4 id="1、开启TopIcons-Plus，增加系统shell托盘"><a href="#1、开启TopIcons-Plus，增加系统shell托盘" class="headerlink" title="1、开启TopIcons Plus，增加系统shell托盘"></a>1、开启<code>TopIcons Plus</code>，增加系统<code>shell</code>托盘</h4><ul>
<li><p>下载<code>top-icons</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 已安装跳过</span></span><br><span class="line">sudo apt-get install -y gnome-shell-extension-top-icons-plus</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>tweak-&gt;扩展-&gt;开启Topicons plus</code></p>
</li>
</ul>
<h4 id="2、如何打开tweak"><a href="#2、如何打开tweak" class="headerlink" title="2、如何打开tweak"></a>2、如何打开<code>tweak</code></h4><ul>
<li>在应用程序中输入<code>tweak</code></li>
</ul>
<h4 id="3、如何重启Gnome"><a href="#3、如何重启Gnome" class="headerlink" title="3、如何重启Gnome"></a>3、如何重启<code>Gnome</code></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Alt + F2] -&gt; [输入 r] -&gt; [点击 Enter]</span><br></pre></td></tr></table></figure>

<h4 id="4、使用-Dash-to-dock-插件时同时出现两个dock的问题"><a href="#4、使用-Dash-to-dock-插件时同时出现两个dock的问题" class="headerlink" title="4、使用[Dash to dock]插件时同时出现两个dock的问题"></a>4、使用<code>[Dash to dock]</code>插件时同时出现两个dock的问题</h4><p>在<code>tweak</code>设置里关闭<code>[Dash to dock]</code>，关闭后 <code>[Dash to dock]</code> 仍然正常工作，但是不会同时出现两个<code>dock</code>栏。</p>
<h4 id="5、tweak无法选择shell主题"><a href="#5、tweak无法选择shell主题" class="headerlink" title="5、tweak无法选择shell主题"></a>5、<code>tweak</code>无法选择shell主题</h4><p>需要在<code>tweak-&gt;扩展-&gt;开启User Themes</code></p>
<h4 id="6、中文环境下将Home目录下的文件夹切换为英文名"><a href="#6、中文环境下将Home目录下的文件夹切换为英文名" class="headerlink" title="6、中文环境下将Home目录下的文件夹切换为英文名"></a>6、中文环境下将<code>Home</code>目录下的文件夹切换为英文名</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置英文语言环境 (恢复-&gt; zh_CN)</span></span><br><span class="line"><span class="built_in">export</span> LANG=en_US</span><br><span class="line"><span class="comment"># 更新目录</span></span><br><span class="line">xdg-user-dirs-gtk-update</span><br></pre></td></tr></table></figure>

<h4 id="7、18-04开机启动特别慢的问题"><a href="#7、18-04开机启动特别慢的问题" class="headerlink" title="7、18.04开机启动特别慢的问题"></a>7、<code>18.04</code>开机启动特别慢的问题</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出程序开机占用时间排行</span></span><br><span class="line">systemd-analyze blame</span><br><span class="line"><span class="comment"># 禁用plymouth</span></span><br><span class="line">sudo systemctl mask plymouth-start.service</span><br><span class="line">sudo systemctl mask plymouth-read-write.service</span><br></pre></td></tr></table></figure>

<h4 id="网易云音乐1-1-0后不能打开的解决方法"><a href="#网易云音乐1-1-0后不能打开的解决方法" class="headerlink" title="网易云音乐1.1.0后不能打开的解决方法"></a>网易云音乐<code>1.1.0</code>后不能打开的解决方法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用root权限命令行后台启动并且屏蔽输出</span></span><br><span class="line">sudo netease-cloud-music &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="comment"># 规避session-manager引起的bug</span></span><br><span class="line"><span class="built_in">alias</span> netease=<span class="string">'unset SESSION_MANAGER &amp;&amp; netease-cloud-music'</span></span><br><span class="line">netease &gt; /dev/null &amp;</span><br></pre></td></tr></table></figure>

<p>推荐使用这个第三方<code>client</code><br><a href="https://github.com/trazyn/ieaseMusic" target="_blank" rel="noopener">https://github.com/trazyn/ieaseMusic</a></p>

        
    </section>
</article>




<nav class="page-nav">
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
</nav>



            </div>
        </div>
        <footer class="footer">
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, Theme by <a href="https://github.com/sanonz/hexo-theme-concise" target="_blank">Concise</a>

    
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?2c09de12c175e88fd5cb35771db9e691";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    
</footer>

    </main>

    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/1.9.0/jquery.min.js"></script>
    <script type="text/javascript">
    $(function() {
        var nodes = {
            nav: $('#nav'),
            aside: $('#aside'),
            asideInner: $('#aside-inner'),
            navInner: $('#nav-inner')
        };

        var doing = false;
        nodes.asideInner.on('webkitAnimationEnd mozAnimationEnd oAnimationEnd oanimationend animationend', function() {
            if (nodes.aside.hasClass('mobile-open')) {
                nodes.aside.removeClass('mobile-open');
            } else {
                nodes.aside.removeClass('mobile-close panel-show');
            }
            doing = false;
        });
        $('#open-panel, #aside-mask').on('click', function() {
            if (doing) {
                return;
            }

            if (nodes.aside.hasClass('panel-show')) {
                nodes.aside.addClass('mobile-close');
            } else {
                nodes.aside.addClass('mobile-open panel-show');
            }
        });
        $('#open-menus').on('click', function() {
            nodes.navInner.slideToggle();
        });

        if (window.innerWidth <= 960) {
            setTimeout(function() {
                nodes.navInner.slideUp();
            }, 3000);
        }
    });
    </script>
    

</body>
</html>
